<view class="container">
  <view class="top-section">
    <view class="month-selector">
      <view class="month-left">
        <picker mode="date" fields="month" value="{{year}}-{{month+1}}" bindchange="bindDateChange">
          <view class="month-title">
            {{year}}å¹´ {{month + 1}}æœˆ <text style="font-size:12px; color:#999;">â–¼</text>
          </view>
        </picker>
        <view class="today-btn" bindtap="goToday">ä»Š</view>
      </view>
      
      <view class="arrows">
        <view class="arrow-btn" bindtap="prevMonth">â†</view>
        <view class="arrow-btn" bindtap="nextMonth">â†’</view>
      </view>
    </view>

    <view class="stats-row">
      <view class="stat-box purple-bg">
        <text class="label">æœ¬æœˆåŠ ç­</text>
        <text class="value">{{currentMonthOt}}h</text>
      </view>
      <view class="stat-box green-bg">
        <text class="label">æœ¬æœˆè°ƒä¼‘</text>
        <text class="value">{{currentMonthOff}}h</text>
      </view>
      <view class="stat-box gray-bg">
        <text class="label">æœ¬æœˆç»“ä½™</text>
        <text class="value">{{currentMonthNet}}h</text>
      </view>
    </view>
  </view>

  <view class="calendar-card card-shadow" bindtouchstart="touchStart" bindtouchend="touchEnd">
    <view class="week-row">
      <view wx:for="{{weekDays}}" wx:key="*this" class="week-item">{{item}}</view>
    </view>

    <view class="days-grid" animation="{{animationData}}">
      <view wx:for="{{emptyGrids}}" wx:key="*this"></view>
      
      <view wx:for="{{days}}" wx:key="date" 
            class="day-cell {{item.selected ? 'selected-day' : ''}} {{item.type === 'overtime' ? 'is-overtime' : ''}} {{item.type === 'off' ? 'is-off' : ''}} {{item.isToday ? 'is-today' : ''}}"
            bindtap="onDayClick" data-day="{{item.day}}">
            
        <text class="day-num">{{item.day}}</text>

        <view wx:if="{{item.tagType === 'rest'}}" class="tag-rest">ä¼‘</view>
        <view wx:if="{{item.tagType === 'work'}}" class="tag-work">ç­</view>

        <text class="day-hours" wx:if="{{item.hours}}">{{item.hours}}h</text>
        <text class="today-tag" wx:elif="{{item.isToday}}">ä»Š</text>
      </view>
    </view>
  </view>

  <view class="bottom-action">
    <view class="info-card empty-state" wx:if="{{!selectedDateStr}}">
      <text>è¯·ç‚¹å‡»æ—¥å†é€‰æ‹©æ—¥æœŸ</text>
    </view>

    <view class="info-card record-state" wx:elif="{{currentDayRecord}}">
      <view class="record-info">
        <view class="record-header">
          <text class="record-date">{{selectedDateStr}}</text>
          <text class="record-badge {{currentDayRecord.type === 'overtime' ? 'badge-red' : 'badge-green'}}">
            {{currentDayRecord.type === 'overtime' ? 'åŠ ç­' : 'è°ƒä¼‘'}}
          </text>
        </view>
        <view class="record-detail">
          <text class="detail-hours">{{currentDayRecord.hours}} å°æ—¶</text>
          <text class="detail-time" wx:if="{{currentDayRecord.startTime}}">{{currentDayRecord.startTime}} - {{currentDayRecord.endTime}}</text>
        </view>
      </view>
      
      <view class="action-btns">
        <view class="icon-btn edit-btn" bindtap="onEditRecord">âœ</view>
        <view class="icon-btn del-btn" bindtap="onDeleteRecord">ğŸ—‘</view>
      </view>
    </view>

    <view class="info-card add-state" wx:else>
      <text class="record-date">{{selectedDateStr}}</text>
      <button class="add-btn" bindtap="showModal">+ è®°ä¸€ç¬”</button>
    </view>
  </view>
</view>

<view class="modal-mask" wx:if="{{!modalHidden}}">
  <view class="modal-box card-shadow">
    <view class="modal-header">
      <text>æ–°å»º/ç¼–è¾‘è®°å½•</text>
      <view class="close-icon" bindtap="hideModal">Ã—</view>
    </view>
    
    <view class="type-switch">
      <view class="switch-item {{currentType=='overtime'?'active-ot':''}}" bindtap="changeType" data-type="overtime">åŠ ç­</view>
      <view class="switch-item {{currentType=='off'?'active-off':''}}" bindtap="changeType" data-type="off">è°ƒä¼‘</view>
    </view>

    <view class="time-row">
      <view class="time-group">
        <text class="input-label">å¼€å§‹æ—¶é—´</text>
        <picker mode="time" value="{{startTime}}" bindchange="bindStartTimeChange">
          <view class="time-picker-box">{{startTime}}</view>
        </picker>
      </view>
      <view class="time-divider">è‡³</view>
      <view class="time-group">
        <text class="input-label">ç»“æŸæ—¶é—´</text>
        <picker mode="time" value="{{endTime}}" bindchange="bindEndTimeChange">
          <view class="time-picker-box">{{endTime}}</view>
        </picker>
      </view>
    </view>

    <view class="input-section">
      <text class="input-label">æ€»æ—¶é•¿ (è‡ªåŠ¨è®¡ç®—)</text>
      <input class="num-input {{currentType=='overtime'?'text-red':'text-green'}}" 
             type="digit" 
             value="{{currentHours}}" 
             bindinput="hoursInput" 
             placeholder="0.0" />
    </view>

    <button class="save-btn {{currentType=='overtime'?'btn-red':'btn-green'}}" bindtap="saveRecord">âœ“ ä¿å­˜</button>
  </view>
</view>